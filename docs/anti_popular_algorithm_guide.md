# 去热门算法使用指南

## 📖 概述

去热门算法是一种工程化的号码生成策略，旨在**避免大众选号模式**，从而在中奖时减少与他人撞号导致的分奖风险。

### ⚠️ 重要声明

- **不会提高中奖概率**：任何策略都无法改变彩票的随机性
- **目的是减少分奖**：在中奖概率不变的前提下，提高独享奖金的机会
- **工程化优化**：通过规避热门模式，让资金曲线更平滑

## 🎯 核心原理

### 热门模式检测

去热门算法会检测并避免以下"大众化"选号模式：

#### 1. **连号偏好**
- 人类倾向选择连续号码（如：1,2,3 或 5,6,7,8）
- 算法限制：最多允许2个连号

#### 2. **等差数列**
- 整齐的等差数列（如：5,10,15,20,25,30）
- 算法检测：避免全部或大部分号码形成等差

#### 3. **生日化**
- 过多使用≤31的号码（对应日期）
- 算法平衡：确保大号码也有分布

#### 4. **同尾数集中**
- 多个号码尾数相同（如：3,13,23,33）
- 算法限制：同尾数不超过2个

#### 5. **整齐倍数**
- 5的倍数过多（如：5,10,15,20,25）
- 算法控制：避免过度集中

#### 6. **奇偶极端**
- 全奇或全偶号码
- 算法平衡：保持合理的奇偶比

#### 7. **和值偏离**
- 和值过大或过小
- 算法约束：SSQ在70-140，DLT在60-120

#### 8. **区间集中**
- 号码过度集中在某个区间
- 算法分散：确保多区间分布

## 🔧 使用方法

### 方式1：GUI界面使用（推荐新手）

#### 1.1 启动程序

```bash
python main.py
```

#### 1.2 使用去热门算法

**步骤1：选择彩票类型**
- 在界面顶部选择"双色球(SSQ)"或"大乐透(DLT)"

**步骤2：选择生成策略**

在"生成策略"下拉框中选择以下任一选项：

| 策略选项 | 说明 | 适用场景 |
|---------|------|---------|
| **去热门-严格** | 最大独特性 | 多人合买、大额投注 |
| **去热门-适中** | 平衡模式 ⭐推荐 | 日常购彩 |
| **去热门-轻度** | 轻度规避 | 小额投注 |
| **混合模式** | 50%去热门+50%统计优选 | 多样化需求 |

**步骤3：设置生成注数**
- 在"生成注数"输入框中输入想要生成的注数（默认2注）
- 建议：
  - 日常购彩：2-5注
  - 合买或复式：10-20注
  - 大量生成：20+注（建议使用"去热门-严格"模式）

**步骤4：生成号码**
- 点击"生成号码"按钮
- 等待生成完成（去热门模式可能需要几秒钟）
- 查看生成的号码结果

#### 1.3 GUI界面示意图

```
┌─────────────────────────────────────────────────┐
│  彩票类型: [双色球 ▼]                            │
├─────────────────────────────────────────────────┤
│  生成参数                                        │
│  ┌───────────────────────────────────────────┐  │
│  │ 生成注数: [2      ]                       │  │
│  │ 生成策略: [去热门-适中 ▼]                 │  │
│  └───────────────────────────────────────────┘  │
│                                                  │
│  [生成号码]  [清空结果]                          │
├─────────────────────────────────────────────────┤
│  生成结果                                        │
│  ┌───────────────────────────────────────────┐  │
│  │ 序号 │ 红球              │ 蓝球          │  │
│  │  1   │ 03 12 18 24 29 31 │ 05           │  │
│  │  2   │ 07 14 19 22 27 33 │ 11           │  │
│  └───────────────────────────────────────────┘  │
└─────────────────────────────────────────────────┘
```

#### 1.4 策略对比表

| 策略选项 | 特点 | 生成速度 | 独特性 | 灵活性 |
|---------|------|---------|--------|--------|
| 完全随机 | 纯随机生成 | ⚡⚡⚡ | ⭐⭐ | ⭐⭐⭐ |
| 热门号码 | 频率优先 | ⚡⚡⚡ | ⭐ | ⭐⭐⭐ |
| 冷门号码 | 遗漏优先 | ⚡⚡⚡ | ⭐⭐ | ⭐⭐⭐ |
| 智能推荐 | 多因子加权 | ⚡⚡ | ⭐⭐ | ⭐⭐ |
| 去热门-严格 | 最大独特性 | ⚡ | ⭐⭐⭐⭐⭐ | ⭐ |
| 去热门-适中 | 平衡模式 | ⚡⚡ | ⭐⭐⭐⭐ | ⭐⭐ |
| 去热门-轻度 | 轻度规避 | ⚡⚡ | ⭐⭐⭐ | ⭐⭐⭐ |
| 混合模式 | 多样化组合 | ⚡⚡ | ⭐⭐⭐ | ⭐⭐⭐ |

#### 1.5 GUI使用技巧

**技巧1：快速切换策略**
```
1. 先用"智能推荐"生成2注，查看统计规律
2. 再用"去热门-适中"生成2注，获得独特号码
3. 对比选择自己喜欢的号码
```

**技巧2：批量生成筛选**
```
1. 设置较大注数（如20注）
2. 使用"去热门-严格"模式确保多样性
3. 从生成的号码中挑选自己喜欢的
```

**技巧3：混合使用**
```
1. 使用"混合模式"一次性获得两种算法的号码
2. 既有统计规律支持，又有独特性保障
3. 适合不确定用哪种策略的情况
```

**技巧4：保留原有策略**
```
1. "热门号码"和"冷门号码"策略依然可用
2. 可以根据个人喜好选择追热或追冷
3. 所有策略可以自由切换对比
```

### 方式2：代码方式使用（适合开发者）

#### 2.1 基础用法

```python
from src.core.generators.smart_generator import SmartNumberGenerator

# 创建生成器
generator = SmartNumberGenerator('ssq')  # 或 'dlt'

# 启用去热门模式（默认适中模式）
generator.set_anti_popular_config(enabled=True, mode='moderate')

# 生成号码
numbers = generator.generate_anti_popular(10)

# 查看结果
for i, num in enumerate(numbers, 1):
    print(f"{i}. 红球: {num.red} | 蓝球: {num.blue}")
```

#### 2.2 三种预设模式

##### 模式1：Strict（严格模式）

```python
generator.set_anti_popular_config(enabled=True, mode='strict')
```

**特点：**
- 最大程度避免热门模式
- 号码最独特，撞号概率最低
- 生成速度较慢（需要更多尝试）

**适用场景：**
- 多人合买，追求独特性
- 大额投注，希望减少分奖风险
- 追求极致的去热门效果

**配置参数：**
- 最大热门分数：1分
- 最大连号：1个
- 红球最大重叠：1个
- 蓝球不重复

##### 模式2：Moderate（适中模式）⭐ 推荐

```python
generator.set_anti_popular_config(enabled=True, mode='moderate')
```

**特点：**
- 平衡热门规避和号码多样性
- 生成速度适中
- 号码既独特又灵活

**适用场景：**
- 日常购彩使用
- 平衡策略，适合大多数用户
- 推荐作为默认选择

**配置参数：**
- 最大热门分数：2分
- 最大连号：2个
- 红球最大重叠：2个
- 蓝球不重复

##### 模式3：Light（轻度模式）

```python
generator.set_anti_popular_config(enabled=True, mode='light')
```

**特点：**
- 轻微避免热门
- 保持较高灵活性
- 生成速度快

**适用场景：**
- 小额投注
- 希望保持一定随机性
- 轻度规避热门即可

**配置参数：**
- 最大热门分数：3分
- 最大连号：3个
- 红球最大重叠：3个
- 蓝球可重复1次

### 自定义配置

```python
# 超严格自定义配置
generator.set_anti_popular_config(
    enabled=True,
    mode='strict',
    max_score=0,           # 只接受0分的号码
    max_run=1,             # 不允许连号
    max_red_overlap=0,     # 不允许红球重叠
    max_blue_dup=1,        # 蓝球不重复
    tries_per_ticket=100   # 增加尝试次数
)
```

### 混合模式

结合统计优选和去热门两种算法的优势：

```python
# 50%去热门 + 50%统计优选
generator.set_anti_popular_config(enabled=True, mode='moderate')
numbers = generator.generate_hybrid(10, anti_popular_ratio=0.5)

# 70%去热门 + 30%统计优选
numbers = generator.generate_hybrid(10, anti_popular_ratio=0.7)
```

**混合模式优势：**
- 兼顾两种算法的优点
- 号码更加多样化
- 降低单一策略的风险

## 📊 配置参数说明

### SSQ（双色球）配置

| 参数 | 说明 | 默认值 | 推荐范围 |
|------|------|--------|---------|
| `max_score` | 热门度分数阈值 | 2 | 0-3 |
| `max_run` | 最大连号长度 | 2 | 1-3 |
| `max_same_last_digit` | 同尾数最大数量 | 2 | 2-3 |
| `odd_bounds` | 奇数个数范围 | (2, 4) | (1, 5) |
| `sum_bounds` | 和值范围 | (70, 140) | (60, 150) |
| `max_red_overlap` | 多注间红球最大重叠 | 2 | 0-3 |
| `max_blue_dup` | 蓝球重复次数限制 | 1 | 1-2 |
| `tries_per_ticket` | 每注最大尝试次数 | 60 | 40-100 |

### DLT（大乐透）配置

| 参数 | 说明 | 默认值 | 推荐范围 |
|------|------|--------|---------|
| `max_score` | 热门度分数阈值 | 2 | 0-3 |
| `max_run` | 最大连号长度 | 2 | 1-3 |
| `max_same_last_digit` | 同尾数最大数量 | 2 | 2-3 |
| `odd_bounds` | 奇数个数范围 | (1, 4) | (0, 5) |
| `sum_bounds` | 和值范围 | (60, 120) | (50, 130) |
| `max_front_overlap` | 前区最大重叠 | 2 | 0-3 |
| `max_back_overlap` | 后区最大重叠 | 1 | 0-2 |
| `avoid_back_consecutive` | 是否拒绝后区连号 | False | True/False |
| `tries_per_ticket` | 每注最大尝试次数 | 60 | 40-100 |

## 📈 效果评估

### 多样性分数

算法会自动计算生成号码的多样性分数（0-1）：

- **0.9-1.0**：极高多样性，号码几乎完全独立
- **0.8-0.9**：高多样性，号码重叠很少
- **0.7-0.8**：中等多样性，有一定重叠
- **<0.7**：较低多样性，可能需要调整配置

### 生成报告示例

```
📊 生成报告：
  多样性分数: 0.90
  独立蓝球数: 5/5
  平均红球重叠: 0.60
```

## 💡 使用建议

### 1. 选择合适的模式

- **新手用户**：推荐使用 `moderate` 模式
- **追求独特**：使用 `strict` 模式
- **快速生成**：使用 `light` 模式
- **多样化**：使用 `hybrid` 混合模式

### 2. 注数建议

- **5-10注**：适合日常购彩
- **10-20注**：适合合买或复式
- **20+注**：建议使用strict模式确保多样性

### 3. 性能考虑

- `strict` 模式可能需要更多时间
- 如果生成速度慢，可以：
  - 降低模式严格度
  - 增加 `tries_per_ticket` 参数
  - 减少生成注数

### 4. 与统计优选结合

```python
# 方案1：先用统计优选，再用去热门
smart_numbers = generator.generate_recommended(5)
generator.set_anti_popular_config(enabled=True)
anti_pop_numbers = generator.generate_anti_popular(5)

# 方案2：直接使用混合模式
hybrid_numbers = generator.generate_hybrid(10, anti_popular_ratio=0.5)
```

## 🔍 常见问题

### Q1: 去热门算法会提高中奖率吗？

**A:** 不会。去热门算法不改变中奖概率，只是在中奖时减少分奖风险。

### Q2: 为什么有时会"降级接受"？

**A:** 当尝试次数用完仍未找到满足阈值的号码时，算法会接受当前最好的候选。这是为了确保能够生成足够数量的号码。

### Q3: 如何提高生成质量？

**A:** 
- 增加 `tries_per_ticket` 参数
- 适当放宽 `max_score` 阈值
- 使用 `moderate` 而非 `strict` 模式

### Q4: 多样性分数多少算好？

**A:** 一般来说：
- 0.85以上：优秀
- 0.75-0.85：良好
- 0.65-0.75：一般
- 0.65以下：建议调整配置

### Q5: 去热门和统计优选哪个更好？

**A:** 各有优势：
- **统计优选**：基于历史数据，追求统计规律
- **去热门**：避免大众模式，减少分奖风险
- **混合模式**：结合两者优势，推荐使用

## 📚 进阶用法

### 批量生成并筛选

```python
# 生成大量号码
generator.set_anti_popular_config(enabled=True, mode='moderate')
all_numbers = generator.generate_anti_popular(50)

# 根据热门度筛选
from src.core.generators.anti_popular import PopularityDetector

filtered = []
for num in all_numbers:
    score = PopularityDetector.calculate_ssq_score(
        num.red, num.blue, (70, 140)
    )
    if score <= 1:  # 只要热门度≤1的
        filtered.append(num)

print(f"筛选后剩余 {len(filtered)} 注")
```

### 分析现有号码的热门度

```python
from src.core.generators.anti_popular import PopularityDetector

# 分析一注号码
red = [1, 2, 3, 4, 5, 6]
blue = 8
score = PopularityDetector.calculate_ssq_score(red, blue, (70, 140))
print(f"热门度分数: {score}")

# 分数越高越热门
if score <= 2:
    print("✅ 独特号码")
elif score <= 5:
    print("⚠️ 中等热门")
else:
    print("❌ 高度热门")
```

## 🎨 GUI集成

在GUI中使用去热门算法：

```python
# 在生成策略下拉框中添加选项
strategies = {
    "统计优选": "smart",
    "去热门-严格": "anti_popular_strict",
    "去热门-适中": "anti_popular_moderate",
    "去热门-轻度": "anti_popular_light",
    "混合模式": "hybrid",
    "随机生成": "random"
}

# 根据选择配置生成器
if strategy == "anti_popular_moderate":
    generator.set_anti_popular_config(enabled=True, mode='moderate')
    numbers = generator.generate_anti_popular(count)
elif strategy == "hybrid":
    generator.set_anti_popular_config(enabled=True, mode='moderate')
    numbers = generator.generate_hybrid(count, anti_popular_ratio=0.5)
```

## ⚠️ 注意事项

1. **理性购彩**：任何算法都无法保证中奖
2. **量力而行**：不要过度投注
3. **多样化策略**：可以尝试不同模式和配置
4. **性能权衡**：严格模式可能需要更多时间
5. **参数调优**：根据实际效果调整配置

## 📞 技术支持

如有问题或建议，请查看：
- 项目文档：`docs/`
- 测试脚本：`test_anti_popular.py`
- 源代码：`src/core/generators/anti_popular/`

---

**祝你好运！🍀**

*记住：彩票是娱乐，理性购彩最重要！*

