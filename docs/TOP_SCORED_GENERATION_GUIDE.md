# 最高评分（整注）生成策略 - 使用指南

## 功能概述

"最高评分（整注）"是一种基于评分系统的号码生成策略，通过搜索算法找出评分最高的号码组合（红球+蓝球）。该策略已完整集成到"号码推荐"页面，并实现了以下三大核心功能：

### ✅ 已实现的功能

1. **联动"号码评价"的评分设置**
   - 自动读取"号码评价"页中设置的蓝球权重、遗漏曲线等参数
   - 无需重复配置，一处设置全局生效

2. **暴露搜索参数到UI**
   - 统计期数（periods）：控制统计窗口大小（10-500期）
   - 候选池(红)（pool-size）：控制红球候选池大小（10-30个）
   - 可根据需要平衡"速度"与"全面性"

3. **显示每注的评分值**
   - 结果中每注号码后显示评分（格式：`| 评分: xx.x`）
   - 评分从高到低排列
   - 便于直观了解每注的质量

---

## 使用步骤

### 第一步：配置评分参数（可选）

如果你想自定义评分规则，请先到**"号码评价"**标签页：

1. 找到"评分设置（双色球）"面板
2. 调整以下参数：
   - **蓝球频率权重**：蓝球在频率维度的权重（0.0-1.0，默认0.30）
   - **蓝球遗漏权重**：蓝球在遗漏维度的权重（0.0-1.0，默认0.30）
   - **遗漏曲线**：
     - `linear`：线性曲线，偏好近期出现的号码
     - `gaussian`：高斯曲线，偏好接近平均遗漏的号码
   - **σ系数**：高斯曲线的标准差系数（默认1.0，越大越平缓）

> **提示**：如果不修改，系统将使用默认参数（蓝球权重0.30/0.30，线性曲线）

---

### 第二步：切换到"号码推荐"页

1. 选择**彩票类型**：双色球（目前仅支持双色球）
2. 设置**生成注数**：例如 3 注、5 注等
3. 选择**生成策略**：最高评分（整注）

---

### 第三步：调整搜索参数（可选）

在策略选择下方，你会看到两个搜索参数：

- **统计期数**（默认100）
  - 用于计算频率和遗漏的统计窗口
  - 越大越全面，但计算稍慢
  - 建议范围：50-200

- **候选池(红)**（默认18）
  - 红球候选池的大小
  - 越大搜索空间越大，但耗时增加
  - 建议范围：15-22

> **性能参考**：
> - periods=100, pool-size=18：约20-40秒（推荐）
> - periods=50, pool-size=15：约5-15秒（快速）
> - periods=200, pool-size=22：约60-120秒（全面）

---

### 第四步：查看当前评分参数

当你选择"最高评分（整注）"策略后，界面会自动显示当前使用的评分参数（蓝色字体）：

```
当前评分参数: 蓝球频率权重=0.30, 蓝球遗漏权重=0.30, 遗漏曲线=linear, σ系数=1.00
```

这些参数是从"号码评价"页实时读取的，确保你知道当前使用的是哪套评分规则。

---

### 第五步：生成号码

1. 点击**"生成号码"**按钮
2. 观察状态提示：
   - 生成中：`正在搜索最高评分组合，请稍候...`（橙色）
   - 完成后：`生成完成`（绿色）
3. 等待结果显示（根据参数不同，耗时10-60秒）

---

### 第六步：查看结果

生成完成后，结果区域会显示类似以下内容：

```
正在为【双色球】生成 3 注号码...
使用策略: top_scored

第 1 注: 红球: [11, 16, 17, 24, 28, 33] | 蓝球: 12 | 评分: 91.0
第 2 注: 红球: [9, 16, 17, 24, 28, 33] | 蓝球: 12 | 评分: 90.7
第 3 注: 红球: [11, 16, 17, 24, 28, 32] | 蓝球: 12 | 评分: 90.5
```

**说明**：
- 每注号码后显示评分值（保留1位小数）
- 评分从高到低排列
- 评分反映了该组合在当前评分规则下的综合质量

---

## 评分参数联动验证

如果你想验证评分参数是否正确联动：

1. 记录当前生成的结果和评分
2. 切换到"号码评价"页，修改评分参数（例如改为 gaussian 曲线）
3. 返回"号码推荐"页，观察"当前评分参数"是否更新
4. 重新生成号码，观察评分和结果是否发生变化

---

## 常见问题

### Q1: 为什么生成速度比其他策略慢？

**A**: "最高评分（整注）"策略需要搜索大量组合并逐一评分，因此比随机生成等策略慢。你可以通过以下方式加速：
- 减小"统计期数"（例如从100改为50）
- 减小"候选池(红)"（例如从18改为15）
- 减少"生成注数"

### Q2: 评分参数显示为空或不正确？

**A**: 请确保：
1. 主窗口已正确初始化（evaluation_tab 在 generation_tab 之前创建）
2. "号码评价"页的评分设置控件已正确初始化
3. 尝试先切换到"号码评价"页，再返回"号码推荐"页

### Q3: 能否支持大乐透？

**A**: 目前"最高评分（整注）"策略仅支持双色球。如需大乐透支持，需要：
1. 创建 `scripts/find_top_dlt.py` 脚本
2. 在 DLT 评价器中实现类似的评分参数
3. 在生成页中扩展策略逻辑

### Q4: 如何理解评分值？

**A**: 评分是一个0-100的综合分数，由以下维度加权计算：
- **频率分**（25%）：号码出现频率与理论频率的接近程度
- **遗漏分**（25%）：号码遗漏期数的合理性
- **模式分**（25%）：奇偶比、大小比、区间分布等模式特征
- **独特性分**（25%）：与历史中奖号码的差异程度

其中，频率分和遗漏分中，蓝球占30%权重（可配置）。

### Q5: 为什么有时候评分相同？

**A**: 当多组号码的综合评分非常接近时（差异<0.1），可能显示为相同评分。这是正常现象，说明这些组合质量相当。

---

## 技术细节

### 搜索算法

1. **红球候选池构建**：根据频率和遗漏分数选出高质量红球
2. **模式过滤**：应用奇偶比、大小比、区间覆盖等规则
3. **蓝球枚举**：对每组红球，遍历所有16个蓝球
4. **历史去重**：排除与历史中奖号码完全相同的整注
5. **评分排序**：按总分从高到低排序，返回Top K

### 评分计算

```python
# 频率维度
freq_score = 0.7 * red_freq_score + 0.3 * blue_freq_score

# 遗漏维度
missing_score = 0.7 * red_missing_score + 0.3 * blue_missing_score

# 综合评分
total_score = 0.25 * freq_score + 0.25 * missing_score + 
              0.25 * pattern_score + 0.25 * uniqueness_score
```

其中，红蓝权重比例（默认70:30）可在"号码评价"页配置。

---

## 更新日志

### v1.0 (2025-10-23)
- ✅ 实现"最高评分（整注）"生成策略
- ✅ 联动"号码评价"页的评分设置
- ✅ 暴露搜索参数（periods、pool-size）到UI
- ✅ 在结果中显示每注的评分值
- ✅ 添加状态提示和进度反馈
- ✅ 添加评分参数实时显示

---

## 相关文档

- [评分系统详解](./EVALUATION_SYSTEM.md)
- [Top组合搜索算法](./TOP_SSQ_NUMBERS.md)
- [号码评价功能说明](./NUMBER_EVALUATION.md)

---

**祝你好运！** 🍀

