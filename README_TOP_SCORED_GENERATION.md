# 最高评分（整注）生成策略 - 完整实现

## 📋 项目概述

本项目为彩票工具集的"号码推荐"功能新增了"最高评分（整注）"生成策略，该策略基于评分系统，通过搜索算法找出评分最高的号码组合（红球+蓝球）。

## ✨ 核心功能

### 1. 联动"号码评价"的评分设置 ✅

- 自动读取"号码评价"页中设置的蓝球权重、遗漏曲线等参数
- 无需重复配置，一处设置全局生效
- 实时生效，修改后立即应用

**实现要点**：
- 主窗口初始化顺序调整（先创建评价页，再创建生成页）
- 通过构造函数传递 evaluation_frame 引用
- 实现 `_get_ssq_scoring_config_from_evaluation()` 方法读取配置

### 2. 暴露搜索参数到UI ✅

- 在UI中提供"统计期数"和"候选池大小"两个参数
- 用户可根据需要平衡"速度"与"全面性"
- 参数范围：periods (10-500)，pool_size (10-30)

**实现要点**：
- 使用 IntVar 和 Spinbox 控件
- 默认值：periods=100, pool_size=18
- 参数直接传递给搜索函数

### 3. 在结果中显示每注的评分值 ✅

- 结果中每注号码后显示评分（格式：`| 评分: xx.x`）
- 评分从高到低排列
- 便于直观了解每注的质量

**实现要点**：
- 扩展数据结构，添加 score 字段
- 更新显示逻辑，检查并显示评分
- 评分保留1位小数

## 🎁 附加优化

### 评分参数实时显示
- 当选择"最高评分（整注）"策略时，自动显示当前使用的评分参数
- 蓝色提示文字，清晰易读
- 确保用户知道当前配置

### 状态提示优化
- 生成中：橙色提示"正在搜索最高评分组合，请稍候..."
- 完成后：绿色提示"生成完成"
- 提升用户体验

### 策略切换回调
- 切换到"最高评分（整注）"策略时，自动更新参数显示
- 切换到其他策略时，隐藏参数显示
- 界面更加智能

## 📁 文件结构

```
lottery/
├── src/
│   └── gui/
│       ├── main_window.py          # 修改：调整标签页创建顺序
│       └── generation_frame.py     # 修改：实现三大功能
├── docs/
│   ├── TOP_SCORED_GENERATION_GUIDE.md    # 新增：详细使用指南
│   ├── IMPLEMENTATION_SUMMARY.md         # 新增：实现总结
│   └── QUICK_REFERENCE.md                # 新增：快速参考
├── demo_top_scored_features.py           # 新增：自动化测试脚本
├── test_top_scored_generation.py         # 新增：手动测试脚本
└── README_TOP_SCORED_GENERATION.md       # 本文档
```

## 🚀 快速开始

### 启动GUI
```bash
python test_top_scored_generation.py
```

### 基本使用流程

1. **切换到"号码推荐"标签页**
2. **选择彩票类型**：双色球
3. **设置生成注数**：5
4. **选择生成策略**：最高评分（整注）
5. **点击"生成号码"按钮**
6. **等待结果**（约20-40秒）

### 自定义评分参数（可选）

1. **切换到"号码评价"标签页**
2. **找到"评分设置（双色球）"面板**
3. **调整参数**：
   - 蓝球频率权重：0.0-1.0（默认0.30）
   - 蓝球遗漏权重：0.0-1.0（默认0.30）
   - 遗漏曲线：linear 或 gaussian（默认linear）
   - σ系数：>0（默认1.0）
4. **返回"号码推荐"页**，参数自动生效

## 🧪 测试验证

### 自动化测试
```bash
python demo_top_scored_features.py
```

**测试内容**：
- ✅ 功能1：评分参数联动
- ✅ 功能2：搜索参数控件
- ✅ 功能3：评分显示
- ✅ 集成测试：完整流程

**测试结果**：全部通过 ✅

### 手动测试
```bash
python test_top_scored_generation.py
```

按照屏幕提示进行手动测试，验证所有功能。

## 📊 性能参考

| 配置 | 耗时 | 适用场景 |
|------|------|----------|
| periods=50, pool=15 | 5-15秒 | 快速测试 |
| periods=100, pool=18 | 20-40秒 | 日常使用（推荐） |
| periods=200, pool=22 | 60-120秒 | 深度分析 |

## 📖 文档导航

- **[快速参考](docs/QUICK_REFERENCE.md)** - 快速上手，常用配置
- **[详细指南](docs/TOP_SCORED_GENERATION_GUIDE.md)** - 完整使用说明，常见问题
- **[实现总结](docs/IMPLEMENTATION_SUMMARY.md)** - 技术实现细节，开发参考

## 🎯 推荐配置

### 平衡模式（默认）
```
统计期数: 100
候选池(红): 18
蓝球频率权重: 0.30
蓝球遗漏权重: 0.30
遗漏曲线: linear
```
**特点**：速度与质量平衡，适合日常使用

### 弱化近期偏好
```
统计期数: 100
候选池(红): 18
蓝球频率权重: 0.20
蓝球遗漏权重: 0.20
遗漏曲线: gaussian
σ系数: 1.5
```
**特点**：减少对近期号码的偏好，更注重长期规律

## ❓ 常见问题

### Q: 为什么生成速度慢？
**A**: 搜索算法需要评估大量组合。可以减小"统计期数"或"候选池(红)"来加速。

### Q: 评分参数显示为空？
**A**: 确保先切换到"号码评价"页，再返回"号码推荐"页，并选择"最高评分（整注）"策略。

### Q: 如何理解"遗漏曲线"？
**A**: 
- **linear**：越近期出现的号码评分越高
- **gaussian**：接近平均遗漏的号码评分越高

### Q: 能否支持大乐透？
**A**: 目前仅支持双色球，大乐透支持需要额外开发。

## 🔧 技术栈

- **Python 3.11+**
- **Tkinter** - GUI框架
- **Threading** - 后台任务处理
- **Queue** - 线程间通信

## 📝 开发日志

### v1.0 (2025-10-23)
- ✅ 实现"最高评分（整注）"生成策略
- ✅ 联动"号码评价"页的评分设置
- ✅ 暴露搜索参数（periods、pool-size）到UI
- ✅ 在结果中显示每注的评分值
- ✅ 添加状态提示和进度反馈
- ✅ 添加评分参数实时显示
- ✅ 完成自动化测试
- ✅ 编写完整文档

## 🚧 后续扩展

- [ ] 大乐透支持
- [ ] 进度条显示
- [ ] 结果导出功能
- [ ] 历史记录保存
- [ ] 参数预设功能

## 📄 许可证

本项目遵循原项目的许可证。

## 👥 贡献者

- 实现：Augment Agent
- 测试：自动化测试 + 手动验证
- 文档：完整的用户指南和技术文档

## 💡 小贴士

1. **首次使用**：建议使用默认参数，熟悉流程后再调整
2. **参数调整**：每次只调整一个参数，观察效果
3. **结果比较**：记录不同参数的结果，找到适合自己的配置
4. **评分理解**：评分只是参考，不代表中奖概率
5. **理性购彩**：彩票具有随机性，请理性对待

---

**版本**：v1.0  
**更新日期**：2025-10-23  
**状态**：✅ 已完成并测试通过

**祝你好运！** 🍀

