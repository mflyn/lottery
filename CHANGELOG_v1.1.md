# 更新日志 v1.1

## 版本信息
- **版本号**：v1.1
- **发布日期**：2025-10-23
- **更新类型**：UI优化

---

## 🎯 本次更新

### 问题修复

#### 1. 搜索参数可见性优化 ✅

**问题描述**：
- 统计期数和候选池参数一直显示在界面上
- 这些参数只对"最高评分（整注）"策略有效
- 其他策略不使用这些参数，一直显示会让用户困惑

**解决方案**：
- 默认隐藏搜索参数控件
- 只在选择"最高评分（整注）"策略时显示
- 切换到其他策略时自动隐藏
- 使用 `grid_remove()` 保留布局配置，提升性能

**用户体验改进**：
- ✅ 界面更简洁，不显示无关参数
- ✅ 用户不会被无效参数困扰
- ✅ 界面更智能，自动适应当前选择

#### 2. 候选池标签动态更新 ✅

**问题描述**：
- 候选池标签固定显示为"候选池(红):"
- 切换到大乐透时，标签仍显示"红球"不合适
- 大乐透的前区对应双色球的红球

**解决方案**：
- 根据彩票类型动态更新标签文字
  - 双色球 → "候选池(红):"
  - 大乐透 → "候选池(前区):"
- 彩票类型切换时自动更新
- 显示搜索参数时也更新，确保标签正确

**用户体验改进**：
- ✅ 术语准确，符合彩票规则
- ✅ 标签与彩票类型一致
- ✅ 避免用户混淆

---

## 📁 文件变更

### 修改的文件

#### src/gui/generation_frame.py
- 将搜索参数控件保存为实例变量（第62-76行）
- 新增 `_show_search_params()` 方法 - 显示搜索参数
- 新增 `_hide_search_params()` 方法 - 隐藏搜索参数
- 新增 `_update_pool_size_label()` 方法 - 更新候选池标签
- 修改 `_on_strategy_change()` 方法 - 新增显示/隐藏调用
- 修改 `_on_lottery_type_change()` 方法 - 新增标签更新调用

### 新增的文件

- `test_search_params_visibility.py` - 测试脚本（GUI测试 + 程序化测试）
- `docs/SEARCH_PARAMS_VISIBILITY_UPDATE.md` - 详细更新说明
- `CHANGELOG_v1.1.md` - 本文档

### 更新的文档

- `docs/QUICK_REFERENCE.md`
  - 添加 v1.1 更新说明
  - 更新搜索参数说明（标注只在特定策略时显示）
  - 新增常见问题（为什么看不到搜索参数）

---

## 🧪 测试验证

### 自动化测试
```bash
echo "2" | python test_search_params_visibility.py
```

**测试结果**：
- ✅ 控件创建测试通过
- ✅ 方法存在性测试通过
- ✅ 候选池标签更新测试通过（双色球/大乐透）
- ✅ 显示/隐藏功能测试通过

### 手动测试
```bash
python test_search_params_visibility.py
# 选择 1 进行GUI测试
```

**测试场景**：
1. ✅ 默认状态（统计优选）→ 搜索参数隐藏
2. ✅ 切换到"最高评分（整注）"→ 搜索参数显示
3. ✅ 切换彩票类型到大乐透 → 候选池标签更新为"前区"
4. ✅ 切换回双色球 → 候选池标签更新为"红"
5. ✅ 切换到其他策略 → 搜索参数隐藏

---

## 🎓 技术要点

### 使用 grid_remove() 而非 grid_forget()

**选择理由**：
- `grid_remove()` 保留控件的grid配置（位置、对齐等）
- 再次显示时只需调用 `grid()` 即可恢复
- 性能更好，代码更简洁
- 适合需要反复显示/隐藏的控件

### 双重更新机制

候选池标签在两处更新：
1. `_on_lottery_type_change()` - 彩票类型切换时
2. `_show_search_params()` - 显示搜索参数时

**好处**：
- 确保标签始终与彩票类型一致
- 避免用户看到错误的标签文字

---

## 📊 影响范围

### 受影响的功能
- ✅ 号码推荐页的"最高评分（整注）"策略
- ✅ 搜索参数的显示/隐藏
- ✅ 候选池标签的动态更新

### 不受影响的功能
- ✅ 其他生成策略（统计优选、随机生成等）
- ✅ 评分参数联动
- ✅ 结果显示
- ✅ 后台搜索算法

---

## 🔄 升级说明

### 从 v1.0 升级到 v1.1

**无需额外操作**：
- 直接使用新版本即可
- 所有改动向后兼容
- 不影响现有功能

**新特性**：
- 搜索参数自动显示/隐藏
- 候选池标签自动更新

---

## 📚 相关文档

- [详细更新说明](docs/SEARCH_PARAMS_VISIBILITY_UPDATE.md)
- [快速参考](docs/QUICK_REFERENCE.md)
- [使用指南](docs/TOP_SCORED_GENERATION_GUIDE.md)
- [实现总结](docs/IMPLEMENTATION_SUMMARY.md)

---

## 💡 用户反馈

感谢用户提出的宝贵建议：
1. "统计期数和候选池对所有生成策略都生效吗？如果不是，建议在不生效的策略下隐藏掉。"
2. "彩票类型为大乐透时，候选池怎么还是双色球的红球？？？"

这些反馈帮助我们改进了用户体验！

---

## 🚀 下一步计划

- [ ] 为大乐透实现"最高评分（整注）"策略
- [ ] 添加进度条显示搜索进度
- [ ] 支持结果导出功能
- [ ] 添加参数预设功能

---

**版本**：v1.1  
**状态**：✅ 已发布  
**测试**：✅ 全部通过

